// components/EnhancedScoreCard.jsx
import { useState } from 'react'

function EnhancedScoreCard({ score, onAddEvidence, onDownloadReport, showSwahili }) {
  const [selectedThreat, setSelectedThreat] = useState(null)

  const threatLevels = {
    low: { 
      color: 'green', 
      icon: '‚úÖ',
      message: showSwahili ? 'Usalama wako uko sawa' : 'Your safety is okay'
    },
    medium: { 
      color: 'yellow', 
      icon: '‚ö†Ô∏è',
      message: showSwahili ? 'Tahadhari ndogo' : 'Minor caution needed'
    },
    high: { 
      color: 'orange', 
      icon: 'üö®',
      message: showSwahili ? 'Hatari kubwa - Chukua hatua' : 'High risk - Take action'
    },
    severe: { 
      color: 'red', 
      icon: 'üíÄ',
      message: showSwahili ? 'Hatari ya maisha - Tafuta msaada' : 'Life-threatening - Seek help'
    }
  }

  const threats = [
    {
      id: 'social_media',
      title: showSwahili ? 'Unyanyasaji Mitandaoni' : 'Social Media Harassment',
      description: showSwahili 
        ? 'Maoni machafu, vitisho, au uhariri wa picha zako'
        : 'Abusive comments, threats, or photo manipulation',
      evidenceNeeded: true,
      action: showSwahili ? 'Pakia skrini za maoni' : 'Upload comment screenshots'
    },
    {
      id: 'privacy',
      title: showSwahili ? 'Uvunjaji Faragha' : 'Privacy Breach',
      description: showSwahili
        ? 'Mtu anakuiga, kukutafuta, au kukutahadharisha'
        : 'Someone is impersonating, stalking, or threatening you',
      evidenceNeeded: true,
      action: showSwahili ? 'Pakia ushahidi wa mawasiliano' : 'Upload communication evidence'
    },
    {
      id: 'financial',
      title: showSwahili ? 'Ujangili wa Fedha' : 'Financial Scams',
      description: showSwahili
        ? 'Mtu anajaribi kukudanganya au kukopa pesa'
        : 'Someone is trying to scam or borrow money from you',
      evidenceNeeded: true,
      action: showSwahili ? 'Pakia mazungumzo ya pesa' : 'Upload money conversations'
    }
  ]

  return (
    <div className="space-y-6">
      {/* Score Header */}
      <div className={`bg-${threatLevels[score.level].color}-50 border border-${threatLevels[score.level].color}-200 rounded-xl p-6`}>
        <div className="flex items-center gap-4">
          <span className="text-4xl">{threatLevels[score.level].icon}</span>
          <div>
            <h2 className="text-2xl font-bold text-gray-800">
              {showSwahili ? 'Tathmini ya Usalama' : 'Safety Assessment'}
            </h2>
            <p className={`text-${threatLevels[score.level].color}-700 font-semibold`}>
              {threatLevels[score.level].message}
            </p>
            <p className="text-gray-600 mt-1">
              {showSwahili ? 'Alama yako:' : 'Your score:'} <strong>{score.points}/100</strong>
            </p>
          </div>
        </div>
      </div>

      {/* Action Buttons */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <button
          onClick={onDownloadReport}
          className="p-4 bg-blue-50 border border-blue-200 rounded-xl hover:bg-blue-100 transition-colors text-left"
        >
          <div className="text-2xl mb-2">üìÑ</div>
          <h3 className="font-semibold text-blue-800">
            {showSwahili ? 'Pakua Ripoti' : 'Download Report'}
          </h3>
          <p className="text-sm text-blue-600">
            {showSwahili 
              ? 'Ripoti kamili ya tathmini na mapendekezo'
              : 'Complete assessment report with recommendations'}
          </p>
        </button>

        <button
          onClick={() => onAddEvidence('general')}
          className="p-4 bg-green-50 border border-green-200 rounded-xl hover:bg-green-100 transition-colors text-left"
        >
          <div className="text-2xl mb-2">üõ°Ô∏è</div>
          <h3 className="font-semibold text-green-800">
            {showSwahili ? 'Ongeza Ushahidi' : 'Add Evidence'}
          </h3>
          <p className="text-sm text-green-600">
            {showSwahili 
              ? 'Pakia picha za skrini na ushahidi mwingine'
              : 'Upload screenshots and other evidence'}
          </p>
        </button>
      </div>

      {/* Specific Threats */}
      <div className="bg-white rounded-xl border p-6">
        <h3 className="text-lg font-semibold text-gray-800 mb-4">
          {showSwahili ? 'Vitisho Maalum Vilivyogunduliwa' : 'Specific Threats Detected'}
        </h3>
        
        <div className="space-y-3">
          {threats.map((threat) => (
            <div key={threat.id} className="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50">
              <div className="flex-1">
                <h4 className="font-semibold text-gray-800">{threat.title}</h4>
                <p className="text-sm text-gray-600">{threat.description}</p>
                {threat.evidenceNeeded && (
                  <p className="text-xs text-orange-600 mt-1">
                    ‚ö†Ô∏è {showSwahili ? 'Inahitaji ushahidi' : 'Evidence needed'}
                  </p>
                )}
              </div>
              
              <div className="flex gap-2">
                {threat.evidenceNeeded && (
                  <button
                    onClick={() => onAddEvidence(threat.id)}
                    className="px-3 py-1 bg-orange-100 text-orange-700 rounded-lg text-sm hover:bg-orange-200"
                  >
                    {showSwahili ? 'Pakia' : 'Upload'}
                  </button>
                )}
                <button
                  onClick={() => setSelectedThreat(threat.id)}
                  className="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200"
                >
                  {showSwahili ? 'Msaada' : 'Help'}
                </button>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Help Modal */}
      {selectedThreat && (
        <HelpModal 
          threatId={selectedThreat}
          onClose={() => setSelectedThreat(null)}
          showSwahili={showSwahili}
        />
      )}
    </div>
  )
}

// Help Modal Component
function HelpModal({ threatId, onClose, showSwahili }) {
  const helpContent = {
    social_media: {
      title: showSwahili ? 'Msaada wa Unyanyasaji Mitandaoni' : 'Social Media Harassment Help',
      steps: [
        showSwahili ? '1. Usifute ujumbe wowote - ni ushahidi' : '1. Don\'t delete any messages - they\'re evidence',
        showSwahili ? '2. Piga skrini za mazungumzo yote' : '2. Take screenshots of all conversations',
        showSwahili ? '3. Wasiliana na mwenye tovuti kufuta maoni' : '3. Contact platform to remove comments',
        showSwahili ? '4. Ripoti kwa DCI ikiwa vitisho vinaendelea' : '4. Report to DCI if threats continue'
      ],
      emergency: showSwahili 
        ? 'Piga 1195 kwa msaada wa haraka'
        : 'Call 1195 for immediate support'
    },
    privacy: {
      title: showSwahili ? 'Msaada wa Uvunjaji Faragha' : 'Privacy Breach Help',
      steps: [
        showSwahili ? '1. Badilisha nywila zako zote' : '1. Change all your passwords',
        showSwahili ? '2. Weka mipaka kwenye mitandao yako' : '2. Set boundaries on your networks',
        showSwahili ? '3. Ripoti akaunti zilizoigwa' : '3. Report impersonation accounts',
        showSwahili ? '4. Tafuta ushauri wa kisheria' : '4. Seek legal advice'
      ],
      emergency: showSwahili
        ? 'Piga 999 ikiwa unahisi hatari ya kimwili'
        : 'Call 999 if you feel physical danger'
    },
    financial: {
      title: showSwahili ? 'Msaada wa Ujangili' : 'Scam Assistance',
      steps: [
        showSwahili ? '1. Acha kulipia chochote mara moja' : '1. Stop all payments immediately',
        showSwahili ? '2. Wasiliana na benki yako' : '2. Contact your bank',
        showSwahili ? '3. Ripoti kwa idara ya udanganyifu' : '3. Report to fraud department',
        showSwahili ? '4. Hifadhi ushahidi wote wa mazungumzo' : '4. Save all conversation evidence'
      ],
      emergency: showSwahili
        ? 'Piga benki yako mara moja ukikopa'
        : 'Call your bank immediately if scammed'
    }
  }

  const content = helpContent[threatId]

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
      <div className="bg-white rounded-xl p-6 max-w-md w-full">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-lg font-semibold">{content.title}</h3>
          <button onClick={onClose} className="text-gray-500 hover:text-gray-700">
            ‚úï
          </button>
        </div>
        
        <div className="space-y-3">
          {content.steps.map((step, index) => (
            <p key={index} className="text-sm text-gray-700">{step}</p>
          ))}
        </div>
        
        <div className="mt-4 p-3 bg-red-50 rounded-lg">
          <p className="text-sm text-red-700 font-semibold">üö® {content.emergency}</p>
        </div>
        
        <button
          onClick={onClose}
          className="w-full mt-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          {showSwahili ? 'Sawa Nimeelewa' : 'Okay, I Understand'}
        </button>
      </div>
    </div>
  )
}

export default EnhancedScoreCard